{"version":3,"file":"submenu.js","sources":["../../src/menu/submenu.tsx"],"sourcesContent":["import {\n  defineComponent,\n  computed,\n  inject,\n  ref,\n  provide,\n  onMounted,\n  getCurrentInstance,\n  watch,\n  Slots,\n  toRefs,\n  reactive,\n  nextTick,\n} from 'vue';\nimport props from './submenu-props';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport { TdMenuInterface, TdSubMenuInterface, TdMenuItem } from './const';\nimport FakeArrow from '../common-components/fake-arrow';\nimport useRipple from '../hooks/useRipple';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { Popup, PopupPlacement } from '../popup';\nimport isFunction from 'lodash/isFunction';\n\nexport default defineComponent({\n  name: 'TSubmenu',\n\n  props,\n  setup(props, ctx) {\n    const classPrefix = usePrefixClass();\n    const menu = inject<TdMenuInterface>('TdMenu');\n    const { theme, activeValues, expandValues, isHead, open } = menu;\n    const submenu = inject<TdSubMenuInterface>('TdSubmenu', {});\n    const { setSubPopup, closeParentPopup } = submenu;\n    const mode = computed(() => ctx.attrs.expandType || menu.mode.value);\n\n    const menuItems = ref([]); // 因composition-api的缺陷，不用reactive， 详见：https://github.com/vuejs/composition-api/issues/637\n    const isActive = computed(() => activeValues.value.indexOf(props.value) > -1);\n    const popupVisible = ref(false);\n    const isCursorInPopup = ref(false);\n    const rippleColor = computed(() => (theme.value === 'light' ? '#E7E7E7' : '#383838'));\n    const isOpen = computed(() => {\n      if (mode.value === 'popup') {\n        return popupVisible.value;\n      }\n      return expandValues ? expandValues.value?.includes(props.value) : false;\n    });\n    const isNested = ref(false); // 是否嵌套\n\n    const popupWrapperRef = ref<HTMLElement>();\n    const subPopupRef = ref<HTMLElement>();\n    const submenuRef = ref<HTMLElement>();\n    useRipple(submenuRef, rippleColor);\n\n    const classes = computed(() => [\n      `${classPrefix.value}-submenu`,\n      {\n        [`${classPrefix.value}-is-disabled`]: props.disabled,\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n      },\n    ]);\n    const popupClass = computed(() => [\n      `${classPrefix.value}-menu__popup`,\n      `${classPrefix.value}-is-${isHead ? 'horizontal' : 'vertical'}`,\n      {\n        [`${classPrefix.value}-is-opened`]: popupVisible.value,\n      },\n      'narrow-scrollbar',\n    ]);\n    const submenuClass = computed(() => [\n      `${classPrefix.value}-menu__item`,\n      `${classPrefix.value}-menu__item-spacer`,\n      `${classPrefix.value}-menu__item-spacer--${isHead && !isNested.value ? 'bottom' : 'right'}`,\n      {\n        [`${classPrefix.value}-is-disabled`]: props.disabled,\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n        [`${classPrefix.value}-is-active`]: isActive.value,\n      },\n    ]);\n    const subClass = computed(() => [\n      `${classPrefix.value}-menu__sub`,\n      {\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n      },\n    ]);\n    const arrowClass = computed(() => [\n      {\n        [`${classPrefix.value}-fake-arrow--active`]: isOpen.value,\n      },\n    ]);\n\n    const passSubPopupRefToParent = (val: HTMLElement) => {\n      if (isFunction(setSubPopup)) {\n        setSubPopup(val);\n      }\n    };\n\n    // methods\n    const handleMouseEnter = () => {\n      if (props.disabled) return;\n      setTimeout(() => {\n        if (!popupVisible.value) {\n          open(props.value);\n          // popupVisible设置为TRUE之后打开popup，因此需要在nextTick中确保可以拿到ref值\n          nextTick().then(() => {\n            passSubPopupRefToParent(popupWrapperRef.value);\n          });\n        }\n        popupVisible.value = true;\n      }, 0);\n    };\n\n    const targetInPopup = (el: HTMLElement) => el?.classList.contains(`${classPrefix.value}-menu__popup`);\n    const loopInPopup = (el: HTMLElement): boolean => {\n      if (!el) return false;\n      return targetInPopup(el) || loopInPopup(el.parentElement);\n    };\n\n    const handleMouseLeave = (e: MouseEvent) => {\n      setTimeout(() => {\n        const inPopup = targetInPopup(e.relatedTarget as HTMLElement);\n\n        if (isCursorInPopup.value || inPopup) return;\n        popupVisible.value = false;\n      }, 0);\n    };\n\n    const handleMouseLeavePopup = (e: any) => {\n      const { toElement, relatedTarget } = e;\n      let target = toElement || relatedTarget;\n\n      if (target === subPopupRef.value) return;\n\n      const isSubmenu = (el: Element) => el === submenuRef.value;\n      while (target !== null && target !== document && !isSubmenu(target)) {\n        target = target.parentNode;\n      }\n\n      isCursorInPopup.value = false;\n\n      if (!isSubmenu(target)) {\n        popupVisible.value = false;\n      }\n\n      closeParentPopup?.(e);\n    };\n    const handleEnterPopup = () => {\n      isCursorInPopup.value = true;\n    };\n\n    const handleSubmenuItemClick = () => {\n      if (props.disabled) return;\n      open(props.value);\n    };\n\n    watch(popupVisible, (visible) => {\n      menu.open(props.value, visible ? 'add' : 'remove');\n    });\n\n    // provide\n    const { value } = toRefs(props);\n    provide<TdSubMenuInterface>(\n      'TdSubmenu',\n      reactive({\n        value,\n        addMenuItem: (item: TdMenuItem) => {\n          menuItems.value.push(item);\n          if (submenu) {\n            submenu.addMenuItem(item);\n          }\n        },\n        setSubPopup: (ref: HTMLElement) => {\n          subPopupRef.value = ref;\n        },\n        closeParentPopup: (e: MouseEvent) => {\n          const related = e.relatedTarget as HTMLElement;\n          if (loopInPopup(related)) return;\n          handleMouseLeavePopup(e);\n        },\n      }),\n    );\n\n    watch(popupWrapperRef, () => {\n      // 第一次触发nextTick会取空值，导致subPopupRef拿不到对应的DOM\n      passSubPopupRefToParent(popupWrapperRef.value);\n    });\n\n    onMounted(() => {\n      menu?.vMenu?.add({ value: props.value, parent: submenu?.value, vnode: ctx.slots.default });\n      const instance = getCurrentInstance();\n      let node = instance.parent;\n\n      while (node && !/^t(head)?menu/i.test(node?.type.name)) {\n        if (/submenu/i.test(node?.type.name)) {\n          isNested.value = true;\n          break;\n        }\n        node = node?.parent;\n      }\n    });\n\n    return {\n      classPrefix,\n      menuItems,\n      mode,\n      theme,\n      isHead,\n      isNested,\n      classes,\n      subClass,\n      arrowClass,\n      popupClass,\n      submenuClass,\n      submenuRef,\n      popupWrapperRef,\n      popupVisible,\n      isCursorInPopup,\n      handleEnterPopup,\n      handleMouseEnter,\n      handleMouseLeave,\n      handleMouseLeavePopup,\n      handleSubmenuItemClick,\n    };\n  },\n  methods: {\n    renderPopup(triggerElement: Slots[]) {\n      let placement = 'right-top';\n      if (!this.isNested && this.isHead) {\n        placement = 'bottom-left';\n      }\n      const overlayInnerStyle = this.isNested && this.isHead ? { marginLeft: '0px' } : { [`margin-top': `]: '12px' };\n\n      const popupWrapper = (\n        <div\n          ref=\"popupWrapperRef\"\n          class={[\n            // ...this.popupClass,\n            `${this.classPrefix}-menu__spacer`,\n            `${this.classPrefix}-menu__spacer--${!this.isNested && this.isHead ? 'top' : 'left'}`,\n          ]}\n          onMouseenter={this.handleEnterPopup}\n          onMouseleave={this.handleMouseLeavePopup}\n        >\n          <ul class={`${this.classPrefix}-menu__popup-wrapper narrow-scrollbar`}>\n            {renderContent(this, 'default', 'content')}\n          </ul>\n        </div>\n      );\n      const slots = {\n        content: () => popupWrapper,\n      };\n      const realPopup = (\n        <Popup\n          overlayInnerClassName={[...this.popupClass]}\n          overlayClassName={`${this.classPrefix}-menu--${this.theme}`}\n          visible={this.popupVisible}\n          placement={placement as PopupPlacement}\n          overlayInnerStyle={overlayInnerStyle}\n          v-slots={slots}\n        >\n          <div ref=\"submenuRef\" class={this.submenuClass}>\n            {triggerElement}\n          </div>\n        </Popup>\n      );\n\n      return realPopup;\n    },\n    renderHeadSubmenu() {\n      const icon = renderTNodeJSX(this, 'icon');\n      const normalSubmenu = [\n        <div ref=\"submenuRef\" class={this.submenuClass} onClick={this.handleSubmenuItemClick}>\n          {icon}\n          <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>\n        </div>,\n        <ul style=\"opacity: 0; width: 0; height: 0; overflow: hidden\">{renderContent(this, 'default', 'content')}</ul>,\n      ];\n\n      const needRotate = this.mode === 'popup' && this.isNested;\n\n      const triggerElement = [\n        icon,\n        <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>,\n        <FakeArrow\n          overlayClassName={/menu/i.test(this.$parent.$options.name) ? this.arrowClass : null}\n          overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)` }}\n        />,\n      ];\n\n      return this.mode === 'normal' ? normalSubmenu : this.renderPopup(triggerElement);\n    },\n    renderSubmenu() {\n      const hasContent = this.$slots.content || this.$slots.default;\n      const icon = renderTNodeJSX(this, 'icon');\n      const child = renderContent(this, 'default', 'content');\n      let { parent } = getCurrentInstance();\n      let paddingLeft = 44;\n\n      while (parent && parent.type.name !== 'TMenu') {\n        if (parent.type.name === 'TSubmenu') {\n          paddingLeft += 16;\n        }\n        parent = parent.parent;\n      }\n\n      const needRotate = this.mode === 'popup' && this.isNested;\n\n      const normalSubmenu = [\n        <div ref=\"submenuRef\" class={this.submenuClass} onClick={this.handleSubmenuItemClick}>\n          {icon}\n          <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>\n          {hasContent && (\n            <FakeArrow\n              overlayClassName={this.arrowClass}\n              overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)` }}\n            />\n          )}\n        </div>,\n        <ul class={this.subClass} style={{ '--padding-left': `${paddingLeft}px` }}>\n          {child}\n        </ul>,\n      ];\n\n      const triggerElement = [\n        icon,\n        <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>,\n        <FakeArrow\n          overlayClassName={/menu/i.test(this.$parent.$options.name) ? this.arrowClass : null}\n          overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)`, 'margin-left': 'auto' }}\n        />,\n      ];\n\n      return this.mode === 'normal' ? normalSubmenu : this.renderPopup(triggerElement);\n    },\n  },\n  render() {\n    let child = null;\n    let events = {};\n\n    if (this.mode === 'popup') {\n      events = {\n        onMouseenter: this.handleMouseEnter,\n        onMouseleave: this.handleMouseLeave,\n      };\n    }\n    if (Object.keys(this.$slots).length > 0) {\n      child = this.isHead ? this.renderHeadSubmenu() : this.renderSubmenu();\n    }\n    return (\n      <li class={this.classes} {...events}>\n        {child}\n      </li>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","ctx","classPrefix","usePrefixClass","menu","inject","theme","activeValues","expandValues","isHead","open","submenu","setSubPopup","closeParentPopup","mode","computed","attrs","expandType","value","menuItems","ref","isActive","indexOf","popupVisible","isCursorInPopup","rippleColor","isOpen","_expandValues$value","includes","isNested","popupWrapperRef","subPopupRef","submenuRef","useRipple","classes","_ref","concat","_defineProperty","disabled","popupClass","submenuClass","_ref3","subClass","arrowClass","passSubPopupRefToParent","val","isFunction","handleMouseEnter","setTimeout","nextTick","then","targetInPopup","el","classList","contains","loopInPopup","parentElement","handleMouseLeave","e","inPopup","relatedTarget","handleMouseLeavePopup","toElement","target","isSubmenu","document","parentNode","handleEnterPopup","handleSubmenuItemClick","watch","visible","_toRefs","toRefs","provide","reactive","addMenuItem","item","push","related","onMounted","_menu$vMenu","vMenu","add","parent","vnode","slots","instance","getCurrentInstance","node","test","_node","type","_node2","_node3","methods","renderPopup","triggerElement","_this","placement","overlayInnerStyle","marginLeft","popupWrapper","_createVNode","renderContent","content","realPopup","Popup","_toConsumableArray","_objectSpread","_default","renderHeadSubmenu","icon","renderTNodeJSX","normalSubmenu","silent","needRotate","$parent","$options","transform","renderSubmenu","hasContent","$slots","child","_getCurrentInstance","paddingLeft","FakeArrow","render","events","onMouseenter","onMouseleave","Object","keys","length","_mergeProps"],"mappings":"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"}