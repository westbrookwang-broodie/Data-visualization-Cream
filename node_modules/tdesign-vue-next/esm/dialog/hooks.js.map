{"version":3,"file":"hooks.js","sources":["../../src/dialog/hooks.tsx"],"sourcesContent":["import { getCurrentInstance } from 'vue';\nimport isString from 'lodash/isString';\nimport isObject from 'lodash/isObject';\nimport omit from 'lodash/omit';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport TButton, { ButtonProps } from '../button';\nimport { PopconfirmConfig, DialogConfig, DrawerConfig } from '../config-provider';\nimport type { ClassName } from '../common';\nimport type { TdDialogProps } from './type';\n\nexport interface MixinsConfirmBtn {\n  theme?: MixinsThemeType;\n  className?: ClassName;\n  confirmBtn: TdDialogProps['confirmBtn'];\n  globalConfirm: PopconfirmConfig['confirm'] | DrawerConfig['confirm'] | DialogConfig['confirm'];\n  globalConfirmBtnTheme?: PopconfirmConfig['confirmBtnTheme'] | DialogConfig['confirmBtnTheme'];\n  size?: ButtonProps['size'];\n}\n\nexport interface MixinsCancelBtn {\n  className?: ClassName;\n  cancelBtn: TdDialogProps['cancelBtn'];\n  globalCancel: PopconfirmConfig['cancel'] | DrawerConfig['cancel'] | DialogConfig['cancel'];\n  size?: ButtonProps['size'];\n}\n\nexport type MixinsThemeType = keyof (PopconfirmConfig['confirmBtnTheme'] & DialogConfig['confirmBtnTheme']);\n\nexport interface BtnAction {\n  confirmBtnAction: (e: MouseEvent) => void;\n  cancelBtnAction: (e: MouseEvent) => void;\n}\n\nexport function useAction(action: BtnAction) {\n  const instance = getCurrentInstance();\n  const renderTNodeJSX = useTNodeJSX();\n  // 全局配置属性综合\n  const getDefaultConfirmBtnProps = (options: MixinsConfirmBtn): ButtonProps => {\n    const { globalConfirm, theme, globalConfirmBtnTheme } = options;\n    const defaultTheme = omit(globalConfirmBtnTheme, ['info'])?.[theme] || 'primary';\n    let props: ButtonProps = {\n      theme: defaultTheme,\n      size: options.size,\n      onClick: (e) => {\n        action.confirmBtnAction(e);\n      },\n    };\n    if (isString(globalConfirm)) {\n      props.content = globalConfirm;\n    } else if (isObject(globalConfirm)) {\n      props = { ...props, ...globalConfirm };\n    }\n    return props;\n  };\n  // 全局配置属性综合\n  const getDefaultCancelBtnProps = (options: MixinsCancelBtn): ButtonProps => {\n    const { globalCancel } = options;\n    let props: ButtonProps = {\n      theme: 'default',\n      size: options.size,\n      onClick: (e) => {\n        action.cancelBtnAction(e);\n      },\n    };\n    if (isString(globalCancel)) {\n      props.content = globalCancel;\n    } else if (isObject(globalCancel)) {\n      props = { ...props, ...globalCancel };\n    }\n    return props;\n  };\n  const getButtonByProps = (button: string | ButtonProps, defaultButton: ButtonProps, className?: ClassName) => {\n    let newOptions = defaultButton;\n    if (isString(button)) {\n      newOptions.content = button;\n    } else if (isObject(button)) {\n      newOptions = { ...newOptions, ...button };\n    }\n    return <TButton class={className} {...newOptions} />;\n  };\n  const getConfirmBtn = (options: MixinsConfirmBtn) => {\n    const { confirmBtn, className } = options;\n    if (confirmBtn === null) return null;\n    if (confirmBtn && instance.slots.confirmBtn) {\n      console.warn('Both $props.confirmBtn and $scopedSlots.confirmBtn exist, $props.confirmBtn is preferred.');\n    }\n    const defaultButtonProps = getDefaultConfirmBtnProps(options);\n    // 属性和插槽都不存在，就返回全局默认配置\n    if (!confirmBtn && !instance.slots.confirmBtn) {\n      return <TButton class={className} {...defaultButtonProps} />;\n    }\n    // 如果属性存在，优先返回属性配置\n    if (confirmBtn && ['string', 'object'].includes(typeof confirmBtn)) {\n      return getButtonByProps(confirmBtn as string | ButtonProps, defaultButtonProps, className);\n    }\n    // 渲染插槽 或 function 类型的 confirmBtn，属性优先级更高\n    return renderTNodeJSX('confirmBtn');\n  };\n  const getCancelBtn = (options: MixinsCancelBtn) => {\n    const { cancelBtn, className } = options;\n    if (cancelBtn === null) return null;\n    if (cancelBtn && instance.slots.cancelBtn) {\n      console.warn('Both $props.cancelBtn and $scopedSlots.cancelBtn exist, $props.cancelBtn is preferred.');\n    }\n    const defaultButtonProps: ButtonProps = getDefaultCancelBtnProps(options);\n    // 属性和插槽都不存在，就返回全局默认配置\n    if (!cancelBtn && !instance.slots.cancelBtn) {\n      return <TButton class={className} {...defaultButtonProps} />;\n    }\n    // 如果属性存在，优先返回属性配置\n    if (cancelBtn && ['string', 'object'].includes(typeof cancelBtn)) {\n      return getButtonByProps(cancelBtn as string | ButtonProps, defaultButtonProps);\n    }\n    // 渲染插槽 或 function 类型的 confirmBtn，属性优先级更高\n    return renderTNodeJSX('cancelBtn');\n  };\n  return { getConfirmBtn, getCancelBtn };\n}\n\nexport function useSameTarget(handleClick?: (e: MouseEvent) => void) {\n  // 判断 click 事件的起点和落点所在元素是否一致\n  let MOUSEDOWN_TARGET = false;\n  let MOUSEUP_TARGET = false;\n\n  const onClick = (e: MouseEvent) => {\n    if (MOUSEDOWN_TARGET && MOUSEUP_TARGET) {\n      handleClick(e);\n    }\n    MOUSEDOWN_TARGET = false;\n    MOUSEUP_TARGET = false;\n  };\n\n  const onMousedown = (e: MouseEvent) => {\n    MOUSEDOWN_TARGET = e.target === e.currentTarget;\n  };\n  const onMouseup = (e: MouseEvent) => {\n    MOUSEUP_TARGET = e.target === e.currentTarget;\n  };\n\n  return { onClick, onMousedown, onMouseup };\n}\n"],"names":["useAction","action","instance","getCurrentInstance","renderTNodeJSX","useTNodeJSX","getDefaultConfirmBtnProps","options","_omit","globalConfirm","theme","globalConfirmBtnTheme","defaultTheme","omit","props","size","onClick","e","confirmBtnAction","isString","content","isObject","_objectSpread","getDefaultCancelBtnProps","globalCancel","cancelBtnAction","getButtonByProps","button","defaultButton","className","newOptions","_createVNode","TButton","_mergeProps","getConfirmBtn","confirmBtn","slots","console","warn","defaultButtonProps","includes","_typeof","getCancelBtn","cancelBtn","useSameTarget","handleClick","MOUSEDOWN_TARGET","MOUSEUP_TARGET","onMousedown","target","currentTarget","onMouseup"],"mappings":"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"}