{"version":3,"file":"option.js","sources":["../../src/select/option.tsx"],"sourcesContent":["import { defineComponent, ref, computed, inject, onMounted, onBeforeUnmount } from 'vue';\n\nimport props from './option-props';\nimport Checkbox from '../checkbox/index';\n\n// hooks\nimport { useFormDisabled } from '../form/hooks';\nimport useRipple from '../hooks/useRipple';\nimport { useContent } from '../hooks/tnode';\nimport { usePrefixClass, useCommonClassName } from '../hooks/useConfig';\nimport { selectInjectKey, getNewMultipleValue } from './helper';\nimport { SelectValue } from './type';\n\nexport default defineComponent({\n  name: 'TOption',\n\n  props: {\n    ...props,\n    createAble: Boolean,\n    multiple: Boolean,\n    index: Number,\n    rowIndex: Number,\n    trs: Map,\n    scrollType: String,\n    isVirtual: Boolean,\n    bufferSize: Number,\n    checkAll: Boolean,\n  },\n  emits: ['row-mounted'],\n\n  setup(props, context) {\n    const selectProvider = inject(selectInjectKey);\n    const formDisabled = useFormDisabled();\n\n    const disabled = computed(\n      () =>\n        formDisabled.value ||\n        (props.multiple &&\n          selectProvider.value.max <= (selectProvider.value.selectValue as SelectValue[]).length &&\n          selectProvider.value.max !== 0),\n    );\n\n    const renderContent = useContent();\n\n    const selectName = usePrefixClass('select');\n    const { STATUS, SIZE } = useCommonClassName();\n    const liRef = ref<HTMLElement>();\n\n    const isHover = ref(false);\n\n    const isSelected = computed(() => {\n      if (selectProvider.value.isCheckAll && !props.disabled) return true;\n      return !props.multiple\n        ? selectProvider.value.selectValue === props.value\n        : (selectProvider.value.selectValue as SelectValue[]).includes(props.value);\n    });\n\n    const isIndeterminate = computed(() => {\n      if (!props.checkAll) return false;\n      return selectProvider.value.indeterminate;\n    });\n\n    const classes = computed(() => [\n      `${selectName.value}-option`,\n      [SIZE.value[selectProvider.value.size]],\n      {\n        [STATUS.value.disabled]: disabled.value,\n        [STATUS.value.selected]: isSelected.value,\n        [`${selectName.value}-option__hover`]:\n          (isHover.value || selectProvider.value.hoverIndex === props.index) && !disabled.value && !isSelected.value,\n      },\n    ]);\n\n    const labelText = computed(() => props.label || props.value);\n\n    const handleClick = (e: MouseEvent | KeyboardEvent) => {\n      if (props.disabled) return;\n      if (props.multiple) {\n        handleCheckboxClick(!isSelected.value, { e });\n        e.preventDefault();\n        return;\n      }\n      e.stopPropagation();\n\n      if (props.createAble) {\n        selectProvider.value.handleCreate?.(props.value);\n        if (selectProvider.value.multiple) {\n          (selectProvider.value.selectValue as SelectValue[]).push(props.value);\n          selectProvider.value.handleValueChange(selectProvider.value.selectValue, {\n            selectedOptions: selectProvider.value.getSelectedOptions(),\n            trigger: 'check',\n            e,\n          });\n          return;\n        }\n      }\n\n      selectProvider.value.handleValueChange(props.value, {\n        selectedOptions: selectProvider.value.getSelectedOptions(props.value),\n        trigger: 'check',\n        e,\n      });\n      selectProvider.value.handlePopupVisibleChange(false, { e });\n    };\n\n    const handleCheckboxClick = (val: boolean, context: { e: MouseEvent | KeyboardEvent }) => {\n      if (props.checkAll) {\n        selectProvider.value.onCheckAllChange(val);\n        return;\n      }\n      const newValue = getNewMultipleValue(selectProvider.value.selectValue as SelectValue[], props.value);\n      selectProvider.value.handleValueChange(newValue.value, {\n        selectedOptions: selectProvider.value.getSelectedOptions(newValue.value),\n        trigger: val ? 'check' : 'uncheck',\n        e: context.e,\n      });\n      if (!selectProvider.value.reserveKeyword) {\n        selectProvider.value.handlerInputChange('');\n      }\n    };\n\n    // 处理虚拟滚动节点挂载\n    onMounted(() => {\n      const { trs, rowIndex, isVirtual } = props;\n      if (isVirtual) {\n        trs.set(rowIndex, liRef.value);\n        context.emit('row-mounted');\n      }\n    });\n\n    // 处理虚拟滚动节点移除\n    onBeforeUnmount(() => {\n      if (props.isVirtual) {\n        const { trs, rowIndex } = props;\n        trs.delete(rowIndex);\n      }\n    });\n\n    useRipple(liRef);\n\n    return () => {\n      const optionChild = renderContent('default', 'content') || labelText.value;\n\n      return (\n        <li\n          ref={liRef}\n          class={classes.value}\n          title={props.title || `${labelText.value}`}\n          onMouseenter={() => (isHover.value = true)}\n          onMouseleave={() => (isHover.value = false)}\n          onClick={handleClick}\n        >\n          {selectProvider && props.multiple ? (\n            <Checkbox\n              checked={isSelected.value}\n              disabled={disabled.value && !isSelected.value}\n              onChange={handleCheckboxClick}\n              indeterminate={isIndeterminate.value}\n            >\n              {optionChild}\n            </Checkbox>\n          ) : (\n            <span>{optionChild}</span>\n          )}\n        </li>\n      );\n    };\n  },\n});\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","defineComponent","name","props","_objectSpread","createAble","Boolean","multiple","index","Number","rowIndex","trs","Map","scrollType","String","isVirtual","bufferSize","checkAll","emits","setup","context","selectProvider","inject","selectInjectKey","formDisabled","useFormDisabled","disabled","computed","value","max","selectValue","length","renderContent","useContent","selectName","usePrefixClass","_useCommonClassName","useCommonClassName","STATUS","SIZE","liRef","ref","isHover","isSelected","isCheckAll","includes","isIndeterminate","indeterminate","classes","_ref","concat","size","_defineProperty","selected","hoverIndex","labelText","label","handleClick","e","handleCheckboxClick","preventDefault","stopPropagation","_selectProvider$value","_selectProvider$value2","handleCreate","push","handleValueChange","selectedOptions","getSelectedOptions","trigger","handlePopupVisibleChange","val","onCheckAllChange","newValue","getNewMultipleValue","reserveKeyword","handlerInputChange","onMounted","set","emit","onBeforeUnmount","useRipple","optionChild","_createVNode","title","onMouseenter","onMouseleave","Checkbox","_default"],"mappings":"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"}