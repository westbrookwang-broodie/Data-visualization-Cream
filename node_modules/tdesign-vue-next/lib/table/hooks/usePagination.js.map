{"version":3,"file":"usePagination.js","sources":["../../../src/table/hooks/usePagination.tsx"],"sourcesContent":["import { ref, SetupContext, toRefs, watch } from 'vue';\nimport { useConfig } from '../../hooks/useConfig';\nimport Pagination, { PageInfo, PaginationProps } from '../../pagination';\nimport { TdBaseTableProps, TableRowData } from '../type';\n\n// 分页功能包含：远程数据排序受控、远程数据排序非受控、本地数据排序受控、本地数据排序非受控 等 4 类功能\nexport default function usePagination(props: TdBaseTableProps, context: SetupContext) {\n  const { pagination, data, disableDataPage } = toRefs(props);\n  const { classPrefix } = useConfig();\n  const innerPagination = ref<PaginationProps>(props.pagination);\n\n  const dataSource = ref<TableRowData[]>([]);\n  const isPaginateData = ref(false);\n\n  const updateDataSourceAndPaginate = (current = 1, pageSize = 10) => {\n    const { data } = props;\n    // data 数据数量超出分页大小时，则自动启动本地数据分页\n    const t = Boolean(!disableDataPage.value && data.length > pageSize);\n    isPaginateData.value = t;\n    if (t) {\n      const start = (current - 1) * pageSize;\n      const end = current * pageSize;\n      dataSource.value = data.slice(start, end);\n    } else {\n      dataSource.value = data;\n    }\n  };\n\n  // 受控情况，只有 pagination.current 或者 pagination.pageSize 变化，才对数据进行排序\n  watch(\n    () => [pagination.value?.current, pagination.value?.pageSize, data.value.length, disableDataPage],\n    () => {\n      if (!pagination.value || !pagination.value.current) return;\n      updateDataSourceAndPaginate(pagination.value.current, pagination.value.pageSize);\n    },\n    { immediate: true },\n  );\n\n  // 非受控情况，只执行一次 Props 数据更新（pagination.defaultCurrent 和 pagination.defaultPageSize）\n  watch(\n    [data],\n    () => {\n      if (!pagination.value || !pagination.value.defaultCurrent) return;\n      updateDataSourceAndPaginate(pagination.value.defaultCurrent, pagination.value.defaultPageSize);\n    },\n    { immediate: true },\n  );\n\n  const renderPagination = () => {\n    if (!props.pagination) return null;\n    const paginationProps = { ...props.pagination };\n    // Vue3，两个 onChange 事件绑定，会成为数组，因为需提前移除外部 onChange\n    delete paginationProps.onChange;\n    return (\n      <div class={`${classPrefix.value}-table__pagination`}>\n        <Pagination\n          {...paginationProps}\n          onChange={(pageInfo: PageInfo) => {\n            props.pagination?.onChange?.(pageInfo);\n            innerPagination.value = pageInfo;\n            updateDataSourceAndPaginate(pageInfo.current, pageInfo.pageSize);\n            props.onPageChange?.(pageInfo, dataSource.value);\n          }}\n          v-slots={{ totalContent: context.slots.totalContent }}\n        />\n      </div>\n    );\n  };\n\n  return {\n    isPaginateData,\n    dataSource,\n    innerPagination,\n    renderPagination,\n  };\n}\n"],"names":["usePagination","props","context","_toRefs","toRefs","pagination","data","disableDataPage","_useConfig","useConfig","classPrefix","innerPagination","ref","dataSource","isPaginateData","updateDataSourceAndPaginate","current","arguments","length","undefined","pageSize","t","Boolean","value","start","end","slice","watch","_pagination$value","_pagination$value2","immediate","defaultCurrent","defaultPageSize","renderPagination","paginationProps","_objectSpread","onChange","_createVNode","concat","Pagination","_mergeProps","pageInfo","_props$pagination","_props$pagination$onC","_props$onPageChange","call","onPageChange","totalContent","slots"],"mappings":"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"}