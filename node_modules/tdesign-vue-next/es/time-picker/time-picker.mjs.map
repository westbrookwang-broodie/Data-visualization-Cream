{"version":3,"file":"time-picker.mjs","sources":["../../src/time-picker/time-picker.tsx"],"sourcesContent":["import { computed, defineComponent, ref, toRefs, watch } from 'vue';\nimport dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\nimport { TimeIcon as TdTimeIcon } from 'tdesign-icons-vue-next';\n\nimport TimePickerPanel from './panel/time-picker-panel';\nimport TSelectInput, { TdSelectInputProps } from '../select-input';\nimport { formatInputValue, validateInputValue } from '../_common/js/time-picker/utils';\n\nimport type { InputProps } from '../input';\n\nimport props from './props';\n\n// hooks\nimport useVModel from '../hooks/useVModel';\nimport { useFormDisabled } from '../form/hooks';\nimport { useConfig, usePrefixClass } from '../hooks/useConfig';\nimport { useGlobalIcon } from '../hooks/useGlobalIcon';\n\ndayjs.extend(customParseFormat);\n\nexport default defineComponent({\n  name: 'TTimePicker',\n\n  props: { ...props },\n\n  setup(props) {\n    const currentValue = ref('');\n    const isShowPanel = ref(false);\n    const { globalConfig } = useConfig('timePicker');\n    const { TimeIcon } = useGlobalIcon({ TimeIcon: TdTimeIcon });\n    const { value, modelValue } = toRefs(props);\n    const [innerValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n\n    const disabled = useFormDisabled();\n    const { allowInput, format } = toRefs(props);\n    const { classPrefix } = useConfig('classPrefix');\n\n    const componentName = usePrefixClass('time-picker');\n\n    const inputClasses = computed(() => [\n      `${componentName.value}__group`,\n      {\n        [`${classPrefix.value}-is-focused`]: isShowPanel.value,\n      },\n    ]);\n\n    const handleShowPopup = (visible: boolean, context: { e: MouseEvent }) => {\n      isShowPanel.value = visible;\n      visible ? props.onOpen?.(context) : props.onClose?.(context); // trigger on-open and on-close\n    };\n\n    const handleClear = (context: { e: MouseEvent }) => {\n      const { e } = context;\n      e.stopPropagation();\n      currentValue.value = null;\n      setInnerValue(null);\n    };\n\n    const handleInputChange = (value: string) => {\n      currentValue.value = value;\n    };\n\n    const handleInputBlur: TdSelectInputProps['onBlur'] = (value, { e }) => {\n      if (allowInput.value) {\n        const isValidTime = validateInputValue(currentValue.value, format.value);\n        if (isValidTime) {\n          setInnerValue(formatInputValue(currentValue.value, format.value));\n        }\n      }\n      props.onBlur?.({ value: String(value), e: e as FocusEvent });\n    };\n\n    const handleClickConfirm = () => {\n      const isValidTime = validateInputValue(currentValue.value, format.value);\n      if (isValidTime) setInnerValue(currentValue.value);\n      isShowPanel.value = false;\n    };\n\n    const handlePanelChange = (v: string, e: MouseEvent) => {\n      currentValue.value = v;\n      props.onPick?.(v, { e });\n    };\n\n    watch(\n      () => isShowPanel.value,\n      () => {\n        currentValue.value = isShowPanel.value ? innerValue.value ?? '' : '';\n      },\n    );\n\n    return () => (\n      <div class={componentName.value}>\n        <TSelectInput\n          onFocus={props.onFocus}\n          onClear={handleClear}\n          disabled={disabled.value}\n          clearable={props.clearable}\n          allowInput={allowInput.value}\n          className={inputClasses.value}\n          suffixIcon={() => <TimeIcon />}\n          popupVisible={isShowPanel.value}\n          onInputChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onPopupVisibleChange={handleShowPopup}\n          placeholder={!innerValue.value ? props.placeholder || globalConfig.value.placeholder : undefined}\n          value={isShowPanel.value ? currentValue.value : innerValue.value ?? undefined}\n          inputValue={isShowPanel.value ? currentValue.value : innerValue.value ?? undefined}\n          inputProps={{ ...(props.inputProps as InputProps), size: props.size }}\n          popupProps={{ overlayInnerStyle: { width: 'auto', padding: 0 }, ...(props.popupProps as object) }}\n          status={props.status}\n          tips={props.tips}\n          panel={() => (\n            <TimePickerPanel\n              steps={props.steps}\n              format={format.value}\n              value={currentValue.value}\n              isFooterDisplay={true}\n              isShowPanel={isShowPanel.value}\n              disableTime={props.disableTime}\n              onChange={handlePanelChange}\n              hideDisabledTime={props.hideDisabledTime}\n              handleConfirmClick={handleClickConfirm}\n            />\n          )}\n        />\n      </div>\n    );\n  },\n});\n"],"names":["dayjs","extend","customParseFormat","defineComponent","name","props","_objectSpread","setup","currentValue","ref","isShowPanel","_useConfig","useConfig","globalConfig","_useGlobalIcon","useGlobalIcon","TimeIcon","TdTimeIcon","_toRefs","toRefs","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","innerValue","setInnerValue","disabled","useFormDisabled","_toRefs2","allowInput","format","_useConfig2","classPrefix","componentName","usePrefixClass","inputClasses","computed","concat","_defineProperty","handleShowPopup","visible","context","_props2$onOpen","_props2$onClose","onOpen","onClose","handleClear","e","stopPropagation","handleInputChange","handleInputBlur","_ref2","_props2$onBlur","isValidTime","validateInputValue","formatInputValue","onBlur","String","handleClickConfirm","handlePanelChange","v","_props2$onPick","onPick","watch","_innerValue$value","_innerValue$value2","_innerValue$value3","_createVNode","TSelectInput","onFocus","clearable","suffixIcon","placeholder","inputProps","size","overlayInnerStyle","width","padding","popupProps","status","tips","panel","TimePickerPanel","steps","disableTime","hideDisabledTime"],"mappings":"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"}