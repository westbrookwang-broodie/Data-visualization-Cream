{"version":3,"file":"ImageItem.mjs","sources":["../../../src/image-viewer/base/ImageItem.tsx"],"sourcesContent":["import { computed, defineComponent, ref, watch } from 'vue';\nimport { ImageErrorIcon } from 'tdesign-icons-vue-next';\nimport { usePrefixClass } from '../../hooks/useConfig';\nimport { useDrag } from '../hooks';\n\nexport default defineComponent({\n  name: 'TImageItem',\n  props: {\n    rotate: Number,\n    scale: Number,\n    mirror: Number,\n    src: String,\n    placementSrc: String,\n  },\n  setup(props) {\n    const classPrefix = usePrefixClass();\n    const error = ref(false);\n    const loaded = ref(false);\n    const { transform, mouseDownHandler } = useDrag({ translateX: 0, translateY: 0 });\n\n    const imgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !props.placementSrc || loaded.value ? 'block' : 'none',\n    }));\n    const placementImgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !loaded.value ? 'block' : 'none',\n    }));\n    const boxStyle = computed(() => {\n      const { translateX, translateY } = transform.value;\n      return {\n        transform: `translate(${translateX}px, ${translateY}px) scale(${props.mirror}, 1)`,\n      };\n    });\n\n    const resetStatus = () => {\n      error.value = false;\n      loaded.value = false;\n    };\n\n    watch(\n      () => props.src,\n      () => {\n        resetStatus();\n      },\n    );\n\n    return () => (\n      <div class={`${classPrefix.value}-image-viewer__modal-pic`}>\n        <div class={`${classPrefix.value}-image-viewer__modal-box`} style={boxStyle.value}>\n          {error.value && (\n            <div class={`${classPrefix.value}-image-viewer__img-error`}>\n              {/* 脱离文档流 */}\n              <div class={`${classPrefix.value}-image-viewer__img-error-content`}>\n                <ImageErrorIcon size=\"4em\" />\n                <div class={`${classPrefix.value}-image-viewer__img-error-text`}>图片加载失败，可尝试重新加载</div>\n              </div>\n            </div>\n          )}\n\n          {!error.value && !!props.placementSrc && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={props.placementSrc}\n              style={placementImgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n\n          {!error.value && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={props.src}\n              onLoad={() => (loaded.value = true)}\n              onError={() => (error.value = true)}\n              style={imgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","rotate","Number","scale","mirror","src","String","placementSrc","setup","classPrefix","usePrefixClass","error","ref","loaded","_useDrag","useDrag","translateX","translateY","transform","mouseDownHandler","imgStyle","computed","concat","display","value","placementImgStyle","boxStyle","_transform$value","resetStatus","watch","_createVNode","ImageErrorIcon","onMousedown","event","stopPropagation","onLoad","onError"],"mappings":"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"}