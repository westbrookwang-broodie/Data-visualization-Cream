{"version":3,"file":"useDropdownOptions.mjs","sources":["../../../src/dropdown/hooks/useDropdownOptions.ts"],"sourcesContent":["import { computed, ComputedRef, VNode, getCurrentInstance, Slots } from 'vue';\nimport isString from 'lodash/isString';\nimport isArray from 'lodash/isArray';\nimport camelCase from 'lodash/camelCase';\n\nimport { useChildComponentSlots } from '../../hooks/slot';\nimport type { DropdownOption, TdDropdownProps } from '../type';\n\nexport const getOptionsFromChildren = (menuNode: VNode | VNode[]): DropdownOption[] => {\n  if (!menuNode) return [];\n\n  // 处理内部嵌套场景\n  if (menuNode[0]?.type?.name === 'TDropdownMenu') {\n    const groupChildren = menuNode[0]?.children?.default?.() as VNode;\n    if (isArray(groupChildren)) {\n      return getOptionsFromChildren(groupChildren);\n    }\n  }\n\n  // 处理v-if的场景\n  if (isArray(menuNode[0]?.children)) return getOptionsFromChildren(menuNode[0]?.children);\n\n  if (isArray(menuNode)) {\n    menuNode = menuNode.reduce((acc, item) => {\n      acc = acc.concat(isArray(item.children) ? item.children : item);\n      return acc;\n    }, []);\n    return menuNode\n      .map((item) => {\n        const slotContent = (item.children as any)?.content?.();\n        const slotPrefixIcon = (item.children as any)?.prefixIcon?.() || (item.children as any)?.['prefix-icon']?.();\n        const groupChildren = (item.children as any)?.default?.();\n\n        // 当前节点的渲染内容\n        const contentCtx = groupChildren?.filter?.(\n          (v: VNode) => !['TDropdownMenu', 'TDropdownItem'].includes((v.type as { name: string })?.name),\n        );\n        // 嵌套菜单的节点\n        const childrenCtx = groupChildren?.filter?.(\n          (v: VNode) =>\n            !isString(v.children) && ['TDropdownMenu', 'TDropdownItem'].includes((v.type as { name: string })?.name),\n        );\n\n        // 将item.props的属性名都转成驼峰，再进行传递\n        const itemProps = Object.keys(item.props || {}).reduce((props, propName) => {\n          props[camelCase(propName)] = item.props[propName];\n          return props;\n        }, {});\n\n        return {\n          content: slotContent || contentCtx || groupChildren,\n          ...itemProps,\n          ...(slotPrefixIcon ? { prefixIcon: () => slotPrefixIcon } : {}),\n          children: childrenCtx?.length > 0 ? getOptionsFromChildren(childrenCtx) : null,\n        };\n      })\n      .filter((v) => !!v.content);\n  }\n\n  return [];\n};\n\nexport default function useDropdownOptions(props: TdDropdownProps): ComputedRef<DropdownOption[]> {\n  const getChildComponentSlots = useChildComponentSlots();\n  const instance = getCurrentInstance();\n  const menuSlot =\n    (getChildComponentSlots('DropdownMenu')?.[0]?.children as Slots)?.default?.() || instance.slots?.dropdown?.();\n\n  const dropdownOptions = computed(() => {\n    if (props.options && props.options.length > 0) return props.options;\n\n    return getOptionsFromChildren(menuSlot);\n  });\n  return dropdownOptions;\n}\n"],"names":["getOptionsFromChildren","menuNode","_menuNode$","_menuNode$$type","_menuNode$3","_menuNode$4","type","name","_menuNode$2","_menuNode$2$children","_menuNode$2$children$","groupChildren","children","call","isArray","reduce","acc","item","concat","map","_item$children","_item$children$conten","_item$children2","_item$children2$prefi","_item$children3","_item$children3$prefi","_item$children4","_item$children4$defau","_groupChildren$filter","_groupChildren$filter2","slotContent","content","slotPrefixIcon","prefixIcon","contentCtx","filter","v","_v$type","includes","childrenCtx","_v$type2","isString","itemProps","Object","keys","props","propName","camelCase","_objectSpread","length","useDropdownOptions","_getChildComponentSlo","_getChildComponentSlo2","_getChildComponentSlo3","_getChildComponentSlo4","_instance$slots","_instance$slots$dropd","getChildComponentSlots","useChildComponentSlots","instance","getCurrentInstance","menuSlot","slots","dropdown","dropdownOptions","computed","options"],"mappings":"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"}