{"version":3,"file":"primary-table.mjs","sources":["../../src/table/primary-table.tsx"],"sourcesContent":["import { computed, defineComponent, toRefs, h, ref, onMounted, SetupContext } from 'vue';\nimport get from 'lodash/get';\nimport omit from 'lodash/omit';\nimport baseTableProps from './base-table-props';\nimport primaryTableProps from './primary-table-props';\nimport BaseTable from './base-table';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport useColumnController from './hooks/useColumnController';\nimport useRowExpand from './hooks/useRowExpand';\nimport useTableHeader, { renderTitle } from './hooks/useTableHeader';\nimport useRowSelect from './hooks/useRowSelect';\nimport { TdPrimaryTableProps, PrimaryTableCol, TableRowData, PrimaryTableCellParams } from './type';\nimport useSorter from './hooks/useSorter';\nimport useFilter from './hooks/useFilter';\nimport useDragSort from './hooks/useDragSort';\nimport useAsyncLoading from './hooks/useAsyncLoading';\nimport EditableCell, { EditableCellProps } from './editable-cell';\nimport { PageInfo } from '../pagination';\nimport useClassName from './hooks/useClassName';\nimport useEditableRow from './hooks/useEditableRow';\nimport useStyle from './hooks/useStyle';\nimport { ScrollToElementParams } from '../hooks/useVirtualScrollNew';\n\nexport { BASE_TABLE_ALL_EVENTS } from './base-table';\n\nconst OMIT_PROPS = [\n  'hideSortTips',\n  'dragSort',\n  'defaultExpandedRowKeys',\n  'defaultSelectedRowKeys',\n  'columnController',\n  'filterRow',\n  'sortOnRowDraggable',\n  'expandOnRowClick',\n  'multipleSort',\n  'expandIcon',\n  'reserveSelectedRowOnPaginate',\n  'selectOnRowClick',\n  'onChange',\n  'onAsyncLoadingClick',\n  'onColumnChange',\n  'onColumnControllerVisibleChange',\n  'onDataChange',\n  'onDisplayColumnsChange',\n  'onDragSort',\n  'onExpandChange',\n  'onFilterChange',\n  'onSelectChange',\n  'onSortChange',\n];\n\nexport default defineComponent({\n  name: 'TPrimaryTable',\n\n  props: {\n    ...baseTableProps,\n    ...primaryTableProps,\n  },\n\n  setup(props: TdPrimaryTableProps, context: SetupContext) {\n    const renderTNode = useTNodeJSX();\n    const { columns, columnController } = toRefs(props);\n    const primaryTableRef = ref(null);\n\n    const { classPrefix, tableDraggableClasses, tableBaseClass, tableSelectedClasses, tableSortClasses } =\n      useClassName();\n    const { sizeClassNames } = useStyle(props);\n    // 自定义列配置功能\n    const { tDisplayColumns, renderColumnController } = useColumnController(props, context);\n    // 展开/收起行功能\n    const { showExpandedRow, showExpandIconColumn, getExpandColumn, renderExpandedRow, onInnerExpandRowClick } =\n      useRowExpand(props, context);\n    // 排序功能\n    const { renderSortIcon } = useSorter(props, context);\n    // 行选中功能\n    const {\n      selectedRowClassNames,\n      currentPaginateData,\n      formatToRowSelectColumn,\n      setTSelectedRowKeys,\n      onInnerSelectRowClick,\n    } = useRowSelect(props, tableSelectedClasses);\n    // 过滤功能\n    const {\n      hasEmptyCondition,\n      isTableOverflowHidden,\n      renderFilterIcon,\n      renderFirstFilterRow,\n      setFilterPrimaryTableRef,\n    } = useFilter(props, context);\n\n    // 拖拽排序功能\n    const { isRowHandlerDraggable, isRowDraggable, isColDraggable, setDragSortPrimaryTableRef, setDragSortColumns } =\n      useDragSort(props, context);\n\n    const { renderTitleWidthIcon } = useTableHeader(props);\n    const { renderAsyncLoading } = useAsyncLoading(props);\n\n    const {\n      errorListMap,\n      editableKeysMap,\n      validateRowData,\n      validateTableData,\n      onRuleChange,\n      clearValidateData,\n      onPrimaryTableCellEditChange,\n    } = useEditableRow(props);\n\n    const primaryTableClasses = computed(() => {\n      return {\n        [tableDraggableClasses.colDraggable]: isColDraggable.value,\n        [tableDraggableClasses.rowHandlerDraggable]: isRowHandlerDraggable.value,\n        [tableDraggableClasses.rowDraggable]: isRowDraggable.value,\n        [tableBaseClass.overflowVisible]: isTableOverflowHidden.value === false,\n        [tableBaseClass.tableRowEdit]: props.editableRowKeys,\n      };\n    });\n\n    // 如果想给 TR 添加类名，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowClassNames = computed(() => {\n      const tClassNames = [props.rowClassName, selectedRowClassNames.value];\n      return tClassNames.filter((v) => v);\n    });\n\n    // 如果想给 TR 添加属性，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowAttributes = computed(() => {\n      const tAttributes = [props.rowAttributes];\n      if (isRowHandlerDraggable.value || isRowDraggable.value) {\n        tAttributes.push(({ row }) => ({ 'data-id': get(row, props.rowKey || 'id') }));\n      }\n      return tAttributes.filter((v) => v);\n    });\n\n    // 多个 Hook 共用 primaryTableRef\n    onMounted(() => {\n      setFilterPrimaryTableRef(primaryTableRef.value);\n      setDragSortPrimaryTableRef(primaryTableRef.value);\n    });\n\n    // 对外暴露的方法\n    context.expose({\n      validateRowData,\n      validateTableData,\n      clearValidateData,\n      refreshTable: () => {\n        primaryTableRef.value.refreshTable();\n      },\n      scrollToElement: (data: ScrollToElementParams) => {\n        primaryTableRef.value.virtualConfig.scrollToElement(data);\n      },\n      scrollColumnIntoView: (colKey: string) => {\n        primaryTableRef.value.scrollColumnIntoView(colKey);\n      },\n      // 暴露基础表格 ref 及相关方法\n      baseTableRef: primaryTableRef,\n    });\n\n    // 1. 影响列数量的因素有：自定义列配置、展开/收起行、多级表头；2. 影响表头内容的因素有：排序图标、筛选图标\n    const getColumns = (columns: PrimaryTableCol<TableRowData>[]) => {\n      const arr: PrimaryTableCol<TableRowData>[] = [];\n      for (let i = 0, len = columns.length; i < len; i++) {\n        let item = { ...columns[i] };\n        // 自定义列显示控制\n        const isDisplayColumn = item.children?.length || tDisplayColumns.value?.includes(item.colKey);\n        if (!isDisplayColumn && props.columnController) continue;\n        item = formatToRowSelectColumn(item);\n        const { sort } = props;\n        if (item.sorter && props.showSortColumnBgColor) {\n          const sorts = sort instanceof Array ? sort : [sort];\n          const sortedColumn = sorts.find(\n            (sort) => sort && sort.sortBy === item.colKey && sort.descending !== undefined,\n          );\n          if (sortedColumn) {\n            item.className =\n              item.className instanceof Array\n                ? item.className.concat(tableSortClasses.sortColumn)\n                : [item.className, tableSortClasses.sortColumn];\n          }\n        }\n        // 添加排序图标和过滤图标\n        if (item.sorter || item.filter) {\n          const titleContent = renderTitle(context.slots, item, i);\n          const { ellipsisTitle } = item;\n          item.title = (h, p) => {\n            const sortIcon = item.sorter ? renderSortIcon(p) : null;\n            const filterIcon = item.filter ? renderFilterIcon(p) : null;\n            // @ts-ignore 注意：此处 Vue2 和 Vue3 有所不同\n            const attach = primaryTableRef.value?.tableContentRef;\n            return renderTitleWidthIcon(\n              [titleContent, sortIcon, filterIcon],\n              p.col,\n              p.colIndex,\n              ellipsisTitle,\n              attach,\n              {\n                classPrefix,\n                ellipsisOverlayClassName: props.size !== 'medium' ? sizeClassNames[props.size] : '',\n              },\n            );\n          };\n          item.ellipsisTitle = false;\n        }\n        // 如果是单元格可编辑状态\n        if (item.edit?.component) {\n          const oldCell = item.cell;\n          item.cell = (h, p: PrimaryTableCellParams<TableRowData>) => {\n            const cellProps: EditableCellProps = {\n              ...p,\n              oldCell,\n              tableBaseClass,\n              cellEmptyContent: props.cellEmptyContent,\n              onChange: props.onRowEdit,\n              onValidate: props.onRowValidate,\n              onRuleChange,\n              onEditableChange: onPrimaryTableCellEditChange,\n            };\n            if (props.editableRowKeys) {\n              const rowValue = get(p.row, props.rowKey || 'id');\n              cellProps.editable = editableKeysMap.value[rowValue] || false;\n              const key = [rowValue, p.col.colKey].join('__');\n              const errorList = errorListMap.value?.[key];\n              errorList && (cellProps.errors = errorList);\n            }\n            if (props.editableCellState) {\n              cellProps.readonly = !props.editableCellState(p);\n            }\n            return <EditableCell {...cellProps} v-slots={context.slots} />;\n          };\n        }\n        if (item.children?.length) {\n          item.children = getColumns(item.children);\n        }\n        // 多级表头和自定义列配置特殊逻辑：要么子节点不存在，要么子节点长度大于 1，方便做自定义列配置\n        if (!item.children || item.children?.length) {\n          arr.push(item);\n        }\n      }\n      return arr;\n    };\n\n    const tColumns = computed(() => {\n      const cols = getColumns(columns.value);\n      if (showExpandIconColumn.value) {\n        cols.unshift(getExpandColumn());\n      }\n      return cols;\n    });\n\n    const onInnerPageChange = (pageInfo: PageInfo, newData: Array<TableRowData>) => {\n      currentPaginateData.value = newData;\n      props.onPageChange?.(pageInfo, newData);\n      const changeParams: Parameters<TdPrimaryTableProps['onChange']> = [\n        { pagination: pageInfo },\n        { trigger: 'pagination', currentData: newData },\n      ];\n      props.onChange?.(...changeParams);\n      // 是否在分页时保留选中结果，如果不保留则需清空\n      if (!props.reserveSelectedRowOnPaginate) {\n        setTSelectedRowKeys([], {\n          selectedRowData: [],\n          type: 'uncheck',\n          currentRowKey: 'CLEAR_ON_PAGINATE',\n        });\n      }\n    };\n\n    // handle click and dblclick exits at the same time\n    let timer: any;\n    const DURATION = 250;\n    const onInnerRowClick: TdPrimaryTableProps['onRowClick'] = (params) => {\n      // no dbl click conflict, no delay\n      if (!props.onRowDblclick) {\n        onInnerExpandRowClick(params);\n        onInnerSelectRowClick(params);\n        return;\n      }\n      if (timer) {\n        // dblclick\n        clearTimeout(timer);\n        timer = undefined;\n      } else {\n        timer = setTimeout(() => {\n          onInnerExpandRowClick(params);\n          onInnerSelectRowClick(params);\n          timer = undefined;\n        }, DURATION);\n      }\n    };\n\n    return () => {\n      const formatNode = (\n        api: string,\n        renderInnerNode: Function,\n        condition: boolean,\n        extra?: { reverse?: boolean },\n      ) => {\n        if (!condition) return props[api];\n        const innerNode = renderInnerNode(h);\n        const propsNode = renderTNode(api);\n        if (innerNode && !propsNode) return () => innerNode;\n        if (propsNode && !innerNode) return () => propsNode;\n        if (innerNode && propsNode) {\n          return () =>\n            extra?.reverse ? (\n              <div>\n                {innerNode}\n                {propsNode}\n              </div>\n            ) : (\n              <div>\n                {propsNode}\n                {innerNode}\n              </div>\n            );\n        }\n        return null;\n      };\n      const isColumnController = !!(columnController.value && Object.keys(columnController.value).length);\n      // @ts-ignore\n      const placement = isColumnController ? columnController.value.placement || 'top-right' : '';\n      const isBottomController = isColumnController && placement?.indexOf('bottom') !== -1;\n      const topContent = formatNode('topContent', renderColumnController, isColumnController && !isBottomController);\n      const bottomContent = formatNode('bottomContent', renderColumnController, isBottomController, {\n        reverse: true,\n      });\n      const firstFullRow = formatNode('firstFullRow', renderFirstFilterRow, !hasEmptyCondition.value);\n      const lastFullRow = formatNode('lastFullRow', renderAsyncLoading, !!props.asyncLoading);\n\n      const baseTableProps = {\n        ...omit(props, OMIT_PROPS),\n        rowClassName: tRowClassNames.value,\n        rowAttributes: tRowAttributes.value,\n        columns: tColumns.value,\n        topContent,\n        bottomContent,\n        firstFullRow,\n        lastFullRow,\n        thDraggable: props.dragSort === 'col',\n        onPageChange: onInnerPageChange,\n        renderExpandedRow: showExpandedRow.value ? renderExpandedRow : undefined,\n      };\n\n      if (props.expandOnRowClick || props.selectOnRowClick) {\n        baseTableProps.onRowClick = onInnerRowClick;\n      }\n\n      return (\n        // @ts-ignore\n        <BaseTable\n          ref={primaryTableRef}\n          v-slots={context.slots}\n          {...baseTableProps}\n          class={primaryTableClasses.value}\n          onLeafColumnsChange={setDragSortColumns}\n        />\n      );\n    };\n  },\n});\n"],"names":["OMIT_PROPS","defineComponent","name","props","_objectSpread","baseTableProps","primaryTableProps","setup","context","renderTNode","useTNodeJSX","_toRefs","toRefs","columns","columnController","primaryTableRef","ref","_useClassName","useClassName","classPrefix","tableDraggableClasses","tableBaseClass","tableSelectedClasses","tableSortClasses","_useStyle","useStyle","sizeClassNames","_useColumnController","useColumnController","tDisplayColumns","renderColumnController","_useRowExpand","useRowExpand","showExpandedRow","showExpandIconColumn","getExpandColumn","renderExpandedRow","onInnerExpandRowClick","_useSorter","useSorter","renderSortIcon","_useRowSelect","useRowSelect","selectedRowClassNames","currentPaginateData","formatToRowSelectColumn","setTSelectedRowKeys","onInnerSelectRowClick","_useFilter","useFilter","hasEmptyCondition","isTableOverflowHidden","renderFilterIcon","renderFirstFilterRow","setFilterPrimaryTableRef","_useDragSort","useDragSort","isRowHandlerDraggable","isRowDraggable","isColDraggable","setDragSortPrimaryTableRef","setDragSortColumns","_useTableHeader","useTableHeader","renderTitleWidthIcon","_useAsyncLoading","useAsyncLoading","renderAsyncLoading","_useEditableRow","useEditableRow","errorListMap","editableKeysMap","validateRowData","validateTableData","onRuleChange","clearValidateData","onPrimaryTableCellEditChange","primaryTableClasses","computed","_ref","_defineProperty","colDraggable","value","rowHandlerDraggable","rowDraggable","overflowVisible","tableRowEdit","editableRowKeys","tRowClassNames","tClassNames","rowClassName","filter","v","tRowAttributes","tAttributes","rowAttributes","push","_ref2","row","get","rowKey","onMounted","expose","refreshTable","scrollToElement","data","virtualConfig","scrollColumnIntoView","colKey","baseTableRef","getColumns","arr","_loop","_item$children","_tDisplayColumns$valu","_item$edit","_item$children2","_item$children3","item","i","isDisplayColumn","children","length","includes","sort","sorter","showSortColumnBgColor","sorts","Array","sortedColumn","find","sortBy","descending","className","concat","sortColumn","titleContent","renderTitle","slots","_item","ellipsisTitle","title","h","p","_primaryTableRef$valu","sortIcon","filterIcon","attach","tableContentRef","col","colIndex","ellipsisOverlayClassName","size","edit","component","oldCell","cell","cellProps","cellEmptyContent","onChange","onRowEdit","onValidate","onRowValidate","onEditableChange","_errorListMap$value","rowValue","editable","key","join","errorList","errors","editableCellState","readonly","_createVNode","EditableCell","len","_ret","tColumns","cols","unshift","onInnerPageChange","pageInfo","newData","_props$onPageChange","_props$onChange","onPageChange","call","changeParams","pagination","trigger","currentData","apply","reserveSelectedRowOnPaginate","selectedRowData","type","currentRowKey","timer","DURATION","onInnerRowClick","params","onRowDblclick","clearTimeout","setTimeout","formatNode","api","renderInnerNode","condition","extra","innerNode","propsNode","reverse","isColumnController","Object","keys","placement","isBottomController","indexOf","topContent","bottomContent","firstFullRow","lastFullRow","asyncLoading","omit","thDraggable","dragSort","expandOnRowClick","selectOnRowClick","onRowClick","BaseTable","_mergeProps"],"mappings":"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"}