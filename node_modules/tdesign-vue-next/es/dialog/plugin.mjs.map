{"version":3,"file":"plugin.mjs","sources":["../../src/dialog/plugin.tsx"],"sourcesContent":["import { App, createApp, ref, Plugin, defineComponent, h, onMounted } from 'vue';\nimport DialogComponent from './dialog';\nimport { getAttach } from '../utils/dom';\nimport { DialogOptions, DialogMethod, DialogConfirmMethod, DialogAlertMethod, DialogInstance } from './type';\n\nconst createDialog: DialogMethod = (props: DialogOptions) => {\n  const options = { ...props };\n  const wrapper = document.createElement('div');\n  const visible = ref(false);\n  const { className, style } = options;\n  const component = defineComponent({\n    setup(props, { expose }) {\n      const dialogOptions = ref<Record<string, any>>(options);\n      onMounted(() => {\n        visible.value = true;\n        // 处理 https://github.com/Tencent/tdesign-vue-next/issues/394\n        (document.activeElement as HTMLElement).blur();\n      });\n      const update = (newOptions: DialogOptions) => {\n        dialogOptions.value = {\n          ...options,\n          ...newOptions,\n        };\n      };\n\n      expose({\n        update,\n      });\n\n      return () => {\n        const onClose =\n          options.onClose ||\n          function () {\n            visible.value = false;\n          };\n        delete options.className;\n        delete options.style;\n        return h(DialogComponent, {\n          onClose,\n          visible: visible.value,\n          ...dialogOptions.value,\n        });\n      };\n    },\n  });\n  const dialog = createApp(component).mount(wrapper);\n\n  let preClassName = className;\n\n  const updateClassNameStyle = (className: string, style: DialogOptions['style']) => {\n    if (className) {\n      if (preClassName !== className) {\n        wrapper.firstElementChild.classList.remove(...preClassName.split(' ').map((name) => name.trim()));\n      }\n      className.split(' ').forEach((name) => {\n        wrapper.firstElementChild.classList.add(name.trim());\n      });\n    }\n\n    if (style) {\n      (wrapper.firstElementChild as HTMLElement).style.cssText += style;\n    }\n\n    preClassName = className;\n  };\n\n  updateClassNameStyle(className, style);\n\n  const container = getAttach(options.attach);\n  if (container) {\n    container.appendChild(wrapper);\n  } else {\n    console.error('attach is not exist');\n  }\n\n  const dialogNode: DialogInstance = {\n    show: () => {\n      visible.value = true;\n    },\n    hide: () => {\n      visible.value = false;\n    },\n    update: (newOptions: DialogOptions) => {\n      dialog.update(newOptions);\n      updateClassNameStyle(newOptions.className, newOptions.style);\n    },\n    destroy: () => {\n      visible.value = false;\n      setTimeout(() => {\n        wrapper.parentNode.removeChild(wrapper);\n      }, 300);\n    },\n  };\n  return dialogNode;\n};\ninterface ExtraApi {\n  confirm: DialogConfirmMethod;\n  alert: DialogAlertMethod;\n}\n\nconst confirm: DialogConfirmMethod = (props: DialogOptions) => createDialog(props);\n\nconst alert: DialogAlertMethod = (props: Omit<DialogOptions, 'confirmBtn'>) => {\n  const options = { ...props };\n  options.cancelBtn = null;\n  return createDialog(options);\n};\n\nconst extraApi: ExtraApi = {\n  confirm,\n  alert,\n};\n\nexport type DialogPluginType = Plugin & ExtraApi & DialogAlertMethod;\n\nexport const DialogPlugin: DialogPluginType = createDialog as DialogPluginType;\n\nDialogPlugin.install = (app: App): void => {\n  app.config.globalProperties.$dialog = createDialog;\n  Object.keys(extraApi).forEach((funcName) => {\n    app.config.globalProperties.$dialog[funcName] = extraApi[funcName];\n  });\n};\n\nObject.keys(extraApi).forEach((funcName) => {\n  DialogPlugin[funcName] = extraApi[funcName];\n});\n\nexport default DialogPlugin;\n"],"names":["createDialog","props","options","_objectSpread","wrapper","document","createElement","visible","ref","className","style","component","defineComponent","setup","expose","_ref","dialogOptions","onMounted","value","activeElement","blur","update","newOptions","onClose","h","DialogComponent","dialog","createApp","mount","preClassName","updateClassNameStyle","_wrapper$firstElement","firstElementChild","classList","remove","apply","_toConsumableArray","split","map","name","trim","forEach","add","cssText","container","getAttach","attach","appendChild","console","error","dialogNode","show","hide","destroy","setTimeout","parentNode","removeChild","confirm","alert","cancelBtn","extraApi","DialogPlugin","install","app","config","globalProperties","$dialog","Object","keys","funcName"],"mappings":"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"}