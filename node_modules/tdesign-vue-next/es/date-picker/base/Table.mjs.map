{"version":3,"file":"Table.mjs","sources":["../../../src/date-picker/base/Table.tsx"],"sourcesContent":["import { defineComponent, PropType, computed } from 'vue';\nimport TDatePickerCell from './Cell';\nimport { useConfig, usePrefixClass } from '../../hooks/useConfig';\nimport type { TdDatePickerProps } from '../type';\nimport { parseToDayjs } from '../../_common/js/date-picker/format';\nimport isArray from 'lodash/isArray';\n\nexport default defineComponent({\n  name: 'TDatePickerTable',\n  props: {\n    mode: {\n      type: String as PropType<TdDatePickerProps['mode']>,\n      default: 'date',\n    },\n    value: [String, Number, Array, Date],\n    format: String,\n    firstDayOfWeek: Number,\n    data: Array,\n    time: String,\n    onCellClick: Function,\n    onCellMouseEnter: Function,\n    onCellMouseLeave: Function,\n  },\n  setup(props) {\n    const COMPONENT_NAME = usePrefixClass('date-picker__table');\n    const { globalConfig } = useConfig('datePicker');\n    const { weekdays, weekAbbreviation, dayjsLocale } = globalConfig.value;\n\n    const weekArr = computed(() => {\n      const _weekArr = [];\n      let wi = props.firstDayOfWeek - 1;\n      const len = weekdays.length;\n      while (_weekArr.length < len) {\n        _weekArr.push(weekdays[wi]);\n        wi = (wi + len + 1) % len;\n      }\n\n      if (props.mode === 'week') _weekArr.unshift(weekAbbreviation);\n\n      return _weekArr;\n    });\n\n    const showThead = computed(() => props.mode === 'date' || props.mode === 'week');\n\n    // 高亮周区间\n    const weekRowClass = (value: any, format: string, targetValue: Date) => {\n      if (props.mode !== 'week' || !value) return {};\n\n      if (isArray(value)) {\n        if (!value.length) return {};\n        const [startObj, endObj] = value.map((v) => v && parseToDayjs(v, format));\n        const startYear = startObj && startObj.year();\n        const startWeek = startObj?.locale?.(dayjsLocale)?.week?.();\n        const endYear = endObj && endObj.year();\n        const endWeek = endObj?.locale?.(dayjsLocale)?.week?.();\n\n        const targetObj = parseToDayjs(targetValue, format);\n        const targetYear = targetObj.year();\n        const targetWeek = targetObj.week();\n        const isActive =\n          (targetYear === startYear && targetWeek === startWeek) || (targetYear === endYear && targetWeek === endWeek);\n        const isRange =\n          targetYear >= startYear && targetYear <= endYear && targetWeek > startWeek && targetWeek < endWeek;\n        return {\n          // 同年同周\n          [`${COMPONENT_NAME.value}-${props.mode}-row--active`]: isActive,\n          [`${COMPONENT_NAME.value}-${props.mode}-row--range`]: isRange,\n        };\n      }\n\n      return {\n        [`${COMPONENT_NAME.value}-${props.mode}-row--active`]:\n          parseToDayjs(value, format).locale(dayjsLocale).week() ===\n          parseToDayjs(targetValue, format).locale(dayjsLocale).week(),\n      };\n    };\n\n    return () => (\n      <div class={COMPONENT_NAME.value} onMouseleave={(e: MouseEvent) => props.onCellMouseLeave?.({ e })}>\n        <table>\n          {showThead.value && (\n            <thead>\n              <tr>\n                {weekArr.value.map((value: string, i: number) => (\n                  <th key={i}>{value}</th>\n                ))}\n              </tr>\n            </thead>\n          )}\n          <tbody>\n            {props.data.map((row: Array<any>, i: number) => (\n              <tr\n                key={i}\n                class={{\n                  [`${COMPONENT_NAME.value}-${props.mode}-row`]: true,\n                  ...weekRowClass(props.value, props.format, row[0].value),\n                }}\n              >\n                {row.map((col: any, j: number) => (\n                  <TDatePickerCell\n                    {...col}\n                    key={j}\n                    time={props.time}\n                    onClick={props.onCellClick}\n                    onMouseEnter={props.onCellMouseEnter}\n                  />\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","mode","type","String","value","Number","Array","Date","format","firstDayOfWeek","data","time","onCellClick","Function","onCellMouseEnter","onCellMouseLeave","setup","COMPONENT_NAME","usePrefixClass","_useConfig","useConfig","globalConfig","_globalConfig$value","weekdays","weekAbbreviation","dayjsLocale","weekArr","computed","_weekArr","wi","len","length","push","unshift","showThead","weekRowClass","targetValue","isArray","_startObj$locale","_startObj$locale$call","_startObj$locale$call2","_endObj$locale","_endObj$locale$call","_endObj$locale$call$w","_ref","_value$map","map","v","parseToDayjs","_value$map2","_slicedToArray","startObj","endObj","startYear","year","startWeek","locale","call","week","endYear","endWeek","targetObj","targetYear","targetWeek","isActive","isRange","_defineProperty","concat","_createVNode","onMouseleave","e","_props$onCellMouseLea","i","row","_objectSpread","col","j"],"mappings":"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"}