{"version":3,"file":"draggable.mjs","sources":["../../../../src/_common/js/color-picker/draggable.ts"],"sourcesContent":["/* eslint-disable no-use-before-define */\nexport interface Coordinate {\n  x: number;\n  y: number;\n}\n\nexport type DraggableEvent = MouseEvent;\n\ninterface DraggableCallback {\n  (coordinate: Coordinate, event?: DraggableEvent): void;\n}\n\nexport interface DraggableProps {\n  start?: DraggableCallback;\n  drag?: DraggableCallback;\n  end?: DraggableCallback;\n}\n\ninterface DraggableHandles {\n  start: (this: Draggable, event: DraggableEvent) => {};\n  drag: (this: Draggable, event: DraggableEvent) => {};\n  end: (this: Draggable, event: DraggableEvent) => {};\n}\n\n// 配置项\nconst defaultsOptions: DraggableProps = {\n  start: (coordinate: Coordinate, event: DraggableEvent) => {},\n  drag: (coordinate: Coordinate, event: DraggableEvent) => {},\n  end: (coordinate: Coordinate, event: DraggableEvent) => {},\n};\n\nexport class Draggable {\n  private dragging = false;\n\n  private $el: HTMLElement;\n\n  private props: DraggableProps;\n\n  private handles: DraggableHandles;\n\n  constructor(el: HTMLElement, options?: DraggableProps) {\n    this.$el = el;\n    this.props = { ...defaultsOptions, ...options };\n    this.handles = {\n      start: this.#dragStart.bind(this),\n      drag: this.#drag.bind(this),\n      end: this.#dragEnd.bind(this),\n    };\n    this.$el.addEventListener('mousedown', this.handles.start, false);\n  }\n\n  #dragStart(event: DraggableEvent) {\n    if (this.dragging) {\n      return;\n    }\n    // event.preventDefault();\n    window.addEventListener('mousemove', this.handles.drag, false);\n    window.addEventListener('mouseup', this.handles.end, false);\n    window.addEventListener('contextmenu', this.handles.end, false);\n    this.dragging = true;\n    this.props.start(this.#getCoordinate(event), event);\n  }\n\n  #drag(event: DraggableEvent) {\n    if (!this.dragging) {\n      return;\n    }\n    this.props.drag(this.#getCoordinate(event), event);\n  }\n\n  #dragEnd(event: DraggableEvent) {\n    setTimeout(() => {\n      this.dragging = false;\n      this.props.end(this.#getCoordinate(event), event);\n    }, 0);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n\n  #getCoordinate(event: DraggableEvent) {\n    const rect = this.$el.getBoundingClientRect();\n    const mouseEvent = event;\n    const left = mouseEvent.clientX - rect.left;\n    const top = mouseEvent.clientY - rect.top;\n    return {\n      y: Math.min(Math.max(0, top), rect.height),\n      x: Math.min(Math.max(0, left), rect.width),\n    };\n  }\n\n  destroy() {\n    this.$el.removeEventListener('mousedown', this.handles.start, false);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n}\n\nexport default Draggable;\n"],"names":["defaultsOptions","start","coordinate","event","drag","end","_dragStart","WeakSet","_drag","_dragEnd","_getCoordinate","Draggable","el","options","_classCallCheck","_classPrivateMethodInitSpec","_defineProperty","$el","props","_objectSpread","handles","_classPrivateMethodGet","_dragStart2","bind","_drag2","_dragEnd2","addEventListener","_createClass","key","value","destroy","removeEventListener","window","dragging","_getCoordinate2","call","_this","setTimeout","rect","getBoundingClientRect","mouseEvent","left","clientX","top","clientY","y","Math","min","max","height","x","width"],"mappings":"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"}