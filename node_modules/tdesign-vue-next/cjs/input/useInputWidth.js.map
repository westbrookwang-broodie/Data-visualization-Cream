{"version":3,"file":"useInputWidth.js","sources":["../../src/input/useInputWidth.ts"],"sourcesContent":["import isUndefined from 'lodash/isUndefined';\nimport { onMounted, Ref, ref, watch, nextTick, onBeforeUnmount } from 'vue';\nimport { InputValue, TdInputProps } from './type';\n\nexport default function useInputWidth(\n  props: TdInputProps,\n  inputRef: Ref<HTMLInputElement>,\n  innerValue: Ref<InputValue>,\n) {\n  const inputPreRef = ref<HTMLSpanElement>(null);\n\n  const composing = ref(false);\n  const updateInputWidth = () => {\n    if (!inputPreRef.value || !inputRef.value) return;\n    const { width } = inputPreRef.value.getBoundingClientRect();\n    inputRef.value.style.width = `${width || 0}px`;\n  };\n\n  const addListeners = () => {\n    watch(\n      () => innerValue.value + props.placeholder,\n      () => {\n        if (!props.autoWidth) return;\n        nextTick(() => {\n          updateInputWidth();\n        });\n      },\n      { immediate: true },\n    );\n  };\n\n  onMounted(() => {\n    composing.value = false;\n    if (props.autoWidth) {\n      addListeners();\n    }\n  });\n\n  const resizeObserver = ref<ResizeObserver>(null);\n  // 当元素默认为 display: none 状态，无法提前准确计算宽度，因此需要监听元素宽度变化。比如：Tabs 场景切换。\n  const addTableResizeObserver = (element: Element) => {\n    if (typeof window === 'undefined') return;\n\n    // IE 11 以下使用设置 minWidth 兼容；IE 11 以上使用 ResizeObserver\n    if (isUndefined(window.ResizeObserver) || !element) return;\n    resizeObserver.value = new window.ResizeObserver(() => {\n      updateInputWidth();\n    });\n    resizeObserver.value.observe(element);\n  };\n\n  onMounted(() => {\n    addTableResizeObserver(inputPreRef.value);\n  });\n\n  onBeforeUnmount(() => {\n    resizeObserver.value?.unobserve(inputPreRef.value);\n    resizeObserver.value?.disconnect();\n  });\n\n  return {\n    inputPreRef,\n  };\n}\n"],"names":["useInputWidth","props","inputRef","innerValue","inputPreRef","ref","composing","updateInputWidth","value","_inputPreRef$value$ge","getBoundingClientRect","width","style","concat","addListeners","watch","placeholder","autoWidth","nextTick","immediate","onMounted","resizeObserver","addTableResizeObserver","element","window","isUndefined","ResizeObserver","observe","onBeforeUnmount","_resizeObserver$value","_resizeObserver$value2","unobserve","disconnect"],"mappings":";;;;;;;;;;;;;;;;;AAIwB,SAAAA,aAAAA,CACtBC,KACA,EAAAC,QAAA,EACAC,UACA,EAAA;AACM,EAAA,IAAAC,WAAA,GAAcC,QAAqB,IAAI,CAAA,CAAA;AAEvC,EAAA,IAAAC,SAAA,GAAYD,QAAI,KAAK,CAAA,CAAA;AAC3B,EAAA,IAAME,mBAAmB,SAAnBA,mBAAyB;IAC7B,IAAI,CAACH,WAAA,CAAYI,KAAS,IAAA,CAACN,QAAS,CAAAM,KAAA,EAAO,OAAA;AAC3C,IAAA,IAAAC,qBAAA,GAAkBL,WAAA,CAAYI,MAAME,qBAAsB,EAAA;MAAlDC,KAAA,GAAAF,qBAAA,CAAAE,KAAA,CAAA;AACRT,IAAAA,QAAA,CAASM,KAAM,CAAAI,KAAA,CAAMD,KAAQ,GAAAE,EAAAA,CAAAA,MAAA,CAAGF,KAAS,IAAA,CAAA,EAAA,IAAA,CAAA,CAAA;GAC3C,CAAA;AAEA,EAAA,IAAMG,eAAe,SAAfA,eAAqB;AACzBC,IAAAA,SAAA,CACE,YAAA;AAAA,MAAA,OAAMZ,UAAW,CAAAK,KAAA,GAAQP,KAAM,CAAAe,WAAA,CAAA;AAAA,KAAA,EAC/B,YAAM;AACJ,MAAA,IAAI,CAACf,KAAM,CAAAgB,SAAA,EAAW,OAAA;AACtBC,MAAAA,YAAA,CAAS,YAAM;AACIX,QAAAA,gBAAA,EAAA,CAAA;AACnB,OAAC,CAAA,CAAA;AACH,KAAA,EACA;AAAEY,MAAAA,WAAW,IAAA;AAAK,KAAA,CACpB,CAAA;GACF,CAAA;AAEAC,EAAAA,aAAA,CAAU,YAAM;IACdd,SAAA,CAAUE,KAAQ,GAAA,KAAA,CAAA;IAClB,IAAIP,MAAMgB,SAAW,EAAA;AACNH,MAAAA,YAAA,EAAA,CAAA;AACf,KAAA;AACF,GAAC,CAAA,CAAA;AAEK,EAAA,IAAAO,cAAA,GAAiBhB,QAAoB,IAAI,CAAA,CAAA;AAEzC,EAAA,IAAAiB,sBAAA,GAAyB,SAAzBA,sBAAAA,CAA0BC,OAAqB,EAAA;AACnD,IAAA,IAAI,OAAOC,MAAW,KAAA,WAAA,EAAa,OAAA;IAGnC,IAAIC,+BAAY,CAAAD,MAAA,CAAOE,cAAc,CAAA,IAAK,CAACH,OAAA,EAAS,OAAA;IACpDF,cAAA,CAAeb,KAAQ,GAAA,IAAIgB,MAAO,CAAAE,cAAA,CAAe,YAAM;AACpCnB,MAAAA,gBAAA,EAAA,CAAA;AACnB,KAAC,CAAA,CAAA;AACcc,IAAAA,cAAA,CAAAb,KAAA,CAAMmB,QAAQJ,OAAO,CAAA,CAAA;GACtC,CAAA;AAEAH,EAAAA,aAAA,CAAU,YAAM;AACdE,IAAAA,sBAAA,CAAuBlB,YAAYI,KAAK,CAAA,CAAA;AAC1C,GAAC,CAAA,CAAA;AAEDoB,EAAAA,mBAAA,CAAgB,YAAM;IAAA,IAAAC,qBAAA,EAAAC,sBAAA,CAAA;AACL,IAAA,CAAAD,qBAAA,GAAAR,cAAA,CAAAb,KAAA,MAAAqB,IAAAA,IAAAA,qBAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,qBAAA,CAAOE,SAAU,CAAA3B,WAAA,CAAYI,KAAK,CAAA,CAAA;IACjD,CAAAsB,sBAAA,GAAAT,cAAA,CAAeb,8CAAfsB,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,sBAAA,CAAsBE,UAAW,EAAA,CAAA;AACnC,GAAC,CAAA,CAAA;EAEM,OAAA;AACL5B,IAAAA,WAAA,EAAAA,WAAAA;GACF,CAAA;AACF;;;;"}