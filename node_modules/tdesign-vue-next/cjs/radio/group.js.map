{"version":3,"file":"group.js","sources":["../../src/radio/group.tsx"],"sourcesContent":["import {\n  VNode,\n  defineComponent,\n  h,\n  provide,\n  reactive,\n  ref,\n  computed,\n  onMounted,\n  watch,\n  nextTick,\n  toRefs,\n  onUnmounted,\n} from 'vue';\nimport isString from 'lodash/isString';\nimport isNumber from 'lodash/isNumber';\nimport isNil from 'lodash/isNil';\nimport props from './radio-group-props';\nimport { RadioOptionObj, RadioOption } from './type';\nimport Radio from './radio';\nimport { RadioGroupInjectionKey } from './constants';\nimport { usePrefixClass, useCommonClassName } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport { useTNodeDefault } from '../hooks/tnode';\nimport useKeyboard from './useKeyboard';\nimport isFunction from 'lodash/isFunction';\nimport { useMutationObserver } from '../watermark/hooks';\nimport type { UseMutationObserverReturn } from '../watermark/hooks';\n\nexport default defineComponent({\n  name: 'TRadioGroup',\n  props: { ...props },\n  setup(props) {\n    const { value, modelValue } = toRefs(props);\n    const [innerValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n\n    /** calculate bar style */\n    const radioGroupRef = ref<HTMLElement>();\n    const radioBtnName = usePrefixClass('radio-button');\n    const { STATUS, SIZE } = useCommonClassName();\n\n    // 键盘操作\n    useKeyboard(radioGroupRef, setInnerValue);\n\n    const checkedClassName = computed(() => `.${radioBtnName.value}.${STATUS.value.checked}`);\n\n    const barStyle = ref({ width: '0px', left: '0px' });\n\n    const calcDefaultBarStyle = () => {\n      const div = document.createElement('div');\n      div.setAttribute('style', 'position: absolute; visibility: hidden;');\n      div.appendChild(radioGroupRef.value.cloneNode(true));\n      document.body.appendChild(div);\n\n      const defaultCheckedRadio: HTMLElement = div.querySelector(checkedClassName.value);\n      const { offsetWidth, offsetLeft } = defaultCheckedRadio;\n      barStyle.value = { width: `${offsetWidth}px`, left: `${offsetLeft}px` };\n      document.body.removeChild(div);\n    };\n\n    const calcBarStyle = () => {\n      if (props.variant === 'outline') return;\n\n      const checkedRadio: HTMLElement = radioGroupRef.value.querySelector(checkedClassName.value);\n      if (!checkedRadio) {\n        barStyle.value = { width: '0px', left: '0px' };\n        return;\n      }\n\n      const { offsetWidth, offsetLeft } = checkedRadio;\n      // current node is not rendered，fallback to default render\n      if (!offsetWidth) {\n        calcDefaultBarStyle();\n      } else {\n        barStyle.value = { width: `${offsetWidth}px`, left: `${offsetLeft}px` };\n      }\n    };\n\n    let observerReturn: UseMutationObserverReturn;\n\n    watch(innerValue, async () => {\n      await nextTick();\n      calcBarStyle();\n    });\n    onMounted(() => {\n      calcBarStyle();\n\n      const checkedRadioLabel: HTMLElement = radioGroupRef.value.querySelector(\n        `${checkedClassName.value} .${radioBtnName.value}__label`,\n      );\n      if (checkedRadioLabel) {\n        observerReturn = useMutationObserver(\n          checkedRadioLabel,\n          (mutations) => {\n            mutations.forEach((mutation) => {\n              if (mutation.type === 'characterData') {\n                calcBarStyle();\n              }\n            });\n          },\n          {\n            attributes: true,\n            childList: true,\n            characterData: true,\n            subtree: true,\n          },\n        );\n      }\n    });\n    onUnmounted(() => {\n      observerReturn?.stop();\n    });\n    /** calculate bar style end */\n\n    const { name, disabled } = toRefs(props);\n    provide(\n      RadioGroupInjectionKey,\n      reactive({\n        name,\n        disabled,\n        value: innerValue,\n        allowUncheck: props.allowUncheck,\n        setValue: setInnerValue,\n      }),\n    );\n\n    const radioGroupName = usePrefixClass('radio-group');\n    const renderSlot = useTNodeDefault();\n    const renderBlock = (): VNode => {\n      if (props.variant.includes('filled') && !isNil(innerValue.value))\n        return <div style={barStyle.value} class={`${radioGroupName.value}__bg-block`} />;\n    };\n    const renderOptions = (): VNode[] => {\n      return props.options?.map((option: RadioOption) => {\n        let opt = option as RadioOptionObj;\n        if (isNumber(option) || isString(option)) {\n          opt = { value: option, label: option.toString() };\n        }\n        return (\n          <Radio\n            key={`radio-group-options-${opt.value}-${Math.random()}`}\n            name={props.name}\n            checked={innerValue.value === opt.value}\n            disabled={'disabled' in opt ? opt.disabled : props.disabled}\n            value={opt.value}\n          >\n            {isFunction(opt.label) ? opt.label(h) : opt.label}\n          </Radio>\n        );\n      });\n    };\n\n    const groupClass = computed(() => [\n      `${radioGroupName.value}`,\n      SIZE.value[props.size],\n      {\n        [`${radioGroupName.value}__outline`]: props.variant === 'outline',\n        [`${radioGroupName.value}--filled`]: props.variant.includes('filled'),\n        [`${radioGroupName.value}--primary-filled`]: props.variant === 'primary-filled',\n      },\n    ]);\n\n    return () => (\n      <div ref={radioGroupRef} class={groupClass.value}>\n        {renderSlot('default') || renderOptions()}\n        {renderBlock()}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","_objectSpread","setup","_toRefs","toRefs","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","innerValue","setInnerValue","radioGroupRef","ref","radioBtnName","usePrefixClass","_useCommonClassName","useCommonClassName","STATUS","SIZE","useKeyboard","checkedClassName","computed","concat","checked","barStyle","width","left","calcDefaultBarStyle","div","document","createElement","setAttribute","appendChild","cloneNode","body","defaultCheckedRadio","querySelector","offsetWidth","offsetLeft","removeChild","calcBarStyle","variant","checkedRadio","observerReturn","watch","_callee","_regeneratorRuntime","wrap","_callee$","_context","prev","next","nextTick","stop","onMounted","checkedRadioLabel","useMutationObserver","mutations","forEach","mutation","type","attributes","childList","characterData","subtree","onUnmounted","_observerReturn","_toRefs2","disabled","provide","RadioGroupInjectionKey","reactive","allowUncheck","setValue","radioGroupName","renderSlot","useTNodeDefault","renderBlock","includes","isNil","_createVNode","renderOptions","_props2$options","options","map","option","opt","isNumber","isString","label","toString","Radio","Math","random","_default","isFunction","h","groupClass","_ref2","size","_defineProperty"],"mappings":"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"}