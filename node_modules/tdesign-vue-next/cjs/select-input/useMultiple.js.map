{"version":3,"file":"useMultiple.js","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import { SetupContext, computed, ref, toRefs } from 'vue';\nimport isObject from 'lodash/isObject';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys } from './type';\nimport { SelectInputCommonProperties } from './interface';\nimport { InputValue } from '../input';\nimport TagInput, { TagInputValue, InputValueChangeContext } from '../tag-input';\nimport Loading from '../loading';\nimport useDefault from '../hooks/useDefaultValue';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useFormDisabled } from '../form/hooks';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent }) => void;\n  popupVisible: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps, context: SetupContext) {\n  const { inputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const tagInputRef = ref();\n  const [tInputValue, setTInputValue] = useDefault(\n    inputValue,\n    props.defaultInputValue,\n    props.onInputChange,\n    'inputValue',\n  );\n  const disable = useFormDisabled();\n\n  const iKeys = computed<SelectInputKeys>(() => ({ ...DEFAULT_KEYS, ...props.keys }));\n  const tags = computed<TagInputValue>(() => {\n    if (!(props.value instanceof Array)) {\n      return isObject(props.value) ? [props.value[iKeys.value.label]] : [props.value];\n    }\n    return props.value.map((item) => (isObject(item) ? item[iKeys.value.label] : item));\n  });\n\n  const tPlaceholder = computed<string>(() => (!tags.value || !tags.value.length ? props.placeholder : ''));\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => {\n    const tagInputProps = {\n      ...p.commonInputProps,\n      tagProps: props.tagProps,\n      label: props.label,\n      autoWidth: props.autoWidth,\n      readonly: props.readonly,\n      placeholder: tPlaceholder.value,\n      minCollapsedNum: props.minCollapsedNum,\n      collapsedItems: props.collapsedItems,\n      tag: props.tag,\n      value: tags.value,\n      valueDisplay: props.valueDisplay,\n      inputValue: tInputValue.value || '',\n      inputProps: {\n        readonly: !props.allowInput || props.readonly,\n        inputClass: {\n          [`${classPrefix.value}-input--focused`]: p.popupVisible,\n        },\n        ...props.inputProps,\n      },\n      suffixIcon: !disable.value && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      ...props.tagInputProps,\n    };\n\n    // eslint-disable-next-line\n    const { tips, ...slots } = context.slots;\n    return (\n      <TagInput\n        ref=\"tagInputRef\"\n        {...tagInputProps}\n        v-slots={slots}\n        onInputChange={(val: InputValue, context: InputValueChangeContext) => {\n          // 筛选器统一特性：筛选器按下回车时不清空输入框\n          if (['enter', 'blur'].includes(context?.trigger)) return;\n          setTInputValue(val, { trigger: context.trigger, e: context.e });\n        }}\n        onChange={onTagInputChange}\n        onClear={p.onInnerClear}\n        onBlur={(val, context) => {\n          props.onBlur?.(props.value, { ...context, tagInputValue: val });\n        }}\n        onEnter={(val, context) => {\n          props.onEnter?.(props.value, { ...context, inputValue: tInputValue.value });\n        }}\n        onFocus={(val, context) => {\n          props.onFocus?.(props.value, { ...context, tagInputValue: val });\n        }}\n      />\n    );\n  };\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","context","_toRefs","toRefs","inputValue","classPrefix","usePrefixClass","tagInputRef","ref","_useDefault","useDefault","defaultInputValue","onInputChange","_useDefault2","_slicedToArray","tInputValue","setTInputValue","disable","useFormDisabled","iKeys","computed","_objectSpread","keys","tags","value","Array","isObject","map","item","tPlaceholder","length","placeholder","onTagInputChange","val","_props$onTagChange","trigger","_context2$e","e","stopPropagation","onTagChange","call","renderSelectMultiple","p","tagInputProps","commonInputProps","tagProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","inputProps","allowInput","inputClass","_defineProperty","concat","popupVisible","suffixIcon","loading","_createVNode","Loading","_context$slots","slots","tips","_objectWithoutProperties","_excluded","TagInput","_mergeProps","includes","onInnerClear","onBlur","_props$onBlur","tagInputValue","onEnter","_props$onEnter","onFocus","_props$onFocus"],"mappings":"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"}